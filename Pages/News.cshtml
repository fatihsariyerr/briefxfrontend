@page
@model NewsModel
@{
    ViewData["Title"] = "BriefX | News";
    ViewData["Description"] = "Get the latest updates on global events, political developments, and societal news.";
}

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">
            <!-- Menu -->

            <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
                <div class="app-brand demo">
                   <a href="/News" class="app-brand-link" style="text-decoration: none;">
                        <img style="width:50px;height:50px;" src="~/assets/img/briefxlogo.png" alt="BriefX">
                        <span class="app-brand-text demo menu-text fw-bold ms-2">BriefX</span>
                    </a>

                    <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
                        <i class="bx bx-chevron-left bx-sm d-flex align-items-center justify-content-center"></i>
                    </a>
                </div>

                <div class="menu-inner-shadow"></div>

                <ul class="menu-inner py-1">
                    <!-- Dashboards -->
                    <li class="menu-item active open">
                        <a href="javascript:void(0);" class="menu-link menu-toggle">
                            <i class="menu-icon tf-icons bx bx-home-smile"></i>
                            <div class="text-truncate" data-i18n="Dashboards">News</div>
                            <span class="badge rounded-pill bg-danger ms-auto">4</span>
                        </a>
                        <ul class="menu-sub">
                            <li class="menu-item active">
                                <a href="/News" class="menu-link" style="text-decoration: none;">
                                    <div class="text-truncate" data-i18n="Analytics">World </div>
                                </a>
                            </li>
                            <li class="menu-item ">
                                <a href="/Technology" class="menu-link" style="text-decoration: none;">
                                    <div class="text-truncate" data-i18n="CRM">Science & Technology</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="/Life" class="menu-link" style="text-decoration: none;">
                                    <div class="text-truncate" data-i18n="Logistics">Life</div>
                                </a>
                            </li>
                            <li class="menu-item">
                                <a href="/Sport" class="menu-link" style="text-decoration: none;">
                                    <div class="text-truncate" data-i18n="Academy">Sport</div>
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="menu-header small text-uppercase">
                        <span class="menu-header-text">Entertainment</span>

                    </li>
                    <li class="menu-item ">
                        <a href="/Tests" class="menu-link" style="text-decoration: none;">
                            <i class="menu-icon tf-icons bx bx-test-tube" style="text-decoration: none;"></i>
                            <div class="text-truncate" data-i18n="Boxicons">Tests</div>
                        </a>
                    </li>


                    <li class="menu-item ">
                        <a href="/GamingInternational" class="menu-link" style="text-decoration: none;">
                            <i class="menu-icon tf-icons bx bx-ghost" style="text-decoration: none;"></i>
                            <div class="text-truncate" data-i18n="Boxicons">Gaming</div>
                        </a>
                    </li>

                    <li class="menu-header small text-uppercase">
                        <span class="menu-header-text">Currency</span>
                    </li>
                    <li class="menu-item">
                        <div class="menu-link" style="display: flex; align-items: center;">
                        <img style="width: 25px; height: 25px;" src="/assets/img/dollar.png" alt="Dollar icon"> <span style="margin-left: 15px;">
                                @if (Convert.ToDecimal(NewsModel.EuroRate) != 0)
                                {
                                    decimal euroRate = Convert.ToDecimal(NewsModel.EuroRate);
                                    var euroValue = Convert.ToDecimal(NewsModel.UsdRate) / euroRate;
                                    @euroValue.ToString("F2").Replace(",",".")
                                }
                                else
                                {
                                    <span>Invalid rate</span>
                                } €
                            </span>
                        </div>
                    </li>
                    <li class="menu-item">
                        <div class="menu-link" style="display: flex; align-items: center;">
                            <img style="width: 25px; height: 25px;" src="/assets/img/euro.png" alt="Euro icon">
                            <span style=" margin-left: 15px;">
                                @if (Convert.ToDecimal(NewsModel.UsdRate) != 0)
                                {
                                    decimal euroRate = Convert.ToDecimal(NewsModel.UsdRate);
                                    var euroValue = Convert.ToDecimal(NewsModel.EuroRate) / euroRate;
                                    @euroValue.ToString("F2").Replace(",",".")
                                }
                                else
                                {
                                    <span>Invalid rate</span>
                                } $
                            </span>
                        </div>
                    </li>
                  
                    <li class="menu-header small text-uppercase">
                        <span class="menu-header-text">Weather</span>
                    </li>
                    <li class="menu-item">
                        <div style="overflow: hidden; width: 300px; height: auto; transform: scale(0.8); transform-origin: top left;">
                            <div id="ww_c2ad18de14f04" v='1.3' loc='auto' a='{"t":"horizontal","lang":"en","sl_lpl":1,"ids":[],"font":"Arial","sl_ics":"one_a","sl_sot":"celsius","cl_bkg":"#FFFFFF00","cl_font":"#000000","cl_cloud":"#d4d4d4","cl_persp":"#2196F3","cl_sun":"#FFC107","cl_moon":"#FFC107","cl_thund":"#FF5722","el_phw":3,"el_whr":3}'>Weather Data Source: <a href="https://wetterlang.de/wetter_21_tage/" id="ww_c2ad18de14f04_u" target="_blank">Wetter fur 21 tage</a></div>
                            <script async src="https://app3.weatherwidget.org/js/?id=ww_c2ad18de14f04"></script>
                        </div>
                    </li>
                </ul>
            </aside>

            <!-- / Menu -->
            <!-- Layout container -->
            <div class="layout-page">
                <!-- Navbar -->

                <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
                     id="layout-navbar">
                    <div class="layout-menu-toggle navbar-nav align-items-xl-center me-4 me-xl-0 d-xl-none">
                        <a class="nav-item nav-link px-0 me-xl-6" href="javascript:void(0)">
                            <i class="bx bx-menu bx-md"></i>
                        </a>
                    </div>

                    <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
                        <!-- Search -->
                        <div class="navbar-nav align-items-center w-100">
                            <div style="width:95% !important;" class="nav-item d-flex align-items-center w-100">
                                <i class="bx bx-search bx-md me-2"></i>
                                <input type="text"
                                       id="searchInput"
                                       class="form-control border-0 shadow-none ps-1 ps-sm-2 me-2"
                                       placeholder="Search News ..."
                                       aria-label="Search News ..."
                                       style="flex-grow: 1;" />
                                <button type="button" style="display:none!important;" id="searchButton" class="btn btn-outline-primary">Ara</button>
                                <a href="/Index" class="btn btn-outline-secondary" style="display: flex; align-items: center; text-decoration: none; padding: 5px;">
                                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b4/Flag_of_Turkey.svg/1200px-Flag_of_Turkey.svg.png" alt="TR" style="width: 20px; height: auto; margin-right: 8px;" />
                                    TR
                                </a>


                            </div>
                        </div>
                        <!-- /Search -->



                        <script>document.getElementById('searchButton').addEventListener('click', function () {
                                var query = document.getElementById('searchInput').value;
                                window.location.href = '?search=' + encodeURIComponent(query);
                            });

                            document.getElementById('searchInput').addEventListener('keypress', function (e) {
                                if (e.key === 'Enter') {
                                    var query = document.getElementById('searchInput').value;
                                    window.location.href = '?search=' + encodeURIComponent(query);
                                }
                            });</script>


                    </div>
                </nav>

                <!-- / Navbar -->
                <!-- Content wrapper -->
                <div class="content-wrapper">
                    <!-- Content -->

                    <div class="container-xxl flex-grow-1 container-p-y">
                        <div class="row">
                            <div class="col-xxl-8 mb-6 order-0">
                                <div id="news-container" class="row row-cols-1 row-cols-md-3 g-6 mb-12">


                                    @foreach (var haber in Model.news.Take(15))
                                    {
                                        <div class="col">
                                            <div class="card h-100">

                                                <a href="@haber.Link" target="_blank">
                                                    <img class="card-img-top" src="@haber.ImageUrl" style="width: 100%; height: 200px; object-fit: cover;" alt="Haber Kapak Görseli" loading="lazy" >
                                                </a>
                                                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px; margin-bottom: 17px; font-weight: 500; font-size: 10px;">
                                                    <span style="color:red;font-weight: bold; padding-left: 12px; padding-top: 10px;">
                                                        @haber.Publisher
                                                    </span>
                                                    <span style="font-weight: bold; padding-right: 12px; padding-top: 10px;">
                                                        @haber.PublishedAtFormatted
                                                    </span>
                                                </div>

                                                <a href="@haber.Link" target="_blank" style="text-decoration: none; color: inherit;">
                                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px; margin-bottom: 17px;">
                                                        <h5 style="padding-left: 12px; font-weight: bold;" class="card-title">
                                                            @haber.Title.Replace("&apos;", "'")
                                                        </h5>
                                                    </div>
                                                </a>
                                            </div>
                                        </div>
                                    }


                                </div>
                                <div id="load-more-trigger" style="height: 50px; background-color: transparent;"></div>

                                <script>document.addEventListener('DOMContentLoaded', function () {
                                        const newsContainer = document.getElementById('news-container');
                                        const loadMoreTrigger = document.getElementById('load-more-trigger');
                                        let skip = 15;
                                        const take = 15;

                                        if (!newsContainer || !loadMoreTrigger) {
                                            console.error("Gerekli HTML elemanları bulunamadı.");
                                            return;
                                        }

                                        const observer = new IntersectionObserver(entries => {
                                            const [entry] = entries;
                                            if (entry.isIntersecting) {
                                                // Yükleme işlemini tetikleyin
                                                fetch(`/News?handler=LoadMore&skip=${skip}&take=${take}`)
                                                    .then(response => {
                                                        if (!response.ok) throw new Error("Sunucudan hata döndü.");
                                                        return response.json();
                                                    })
                                                    .then(data => {
                                                        if (!data || !Array.isArray(data) || data.length === 0) {
                                                            console.log("Yüklenecek daha fazla haber yok.");
                                                            observer.disconnect(); // Daha fazla yükleme yapma
                                                            return;
                                                        }

                                                        data.forEach(haber => {
                                                            const div = document.createElement('div');
                                                            div.className = 'col';
                                                            div.innerHTML = `
                                                                                                                            <div class="card h-100">
                                                                                                                                <a href="${haber.link}" target="_blank">
                                                                                                                                    <img class="card-img-top" src="${haber.imageUrl}"
                                                                                                                                         style="width: 100%; height: 200px; object-fit: cover;"
                                                                                                                                         alt="Haber Kapak Görseli" loading="lazy" >
                                                                                                                                </a>
                                                                                                                                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px; margin-bottom: 17px; font-weight: 500; font-size: 10px;">
                                                                                                                                    <span style="color:red;font-weight: bold; padding-left: 12px; padding-top: 10px;">
                                                                                                                                        ${haber.publisher}
                                                                                                                                    </span>
                                                                                                                                    <span style="font-weight: bold; padding-right: 12px; padding-top: 10px;">
                                                                                                                                        ${haber.publishedAtFormatted}
                                                                                                                                    </span>
                                                                                                                                </div>
                                                                                                                                <a href="${haber.link}" target="_blank" style="text-decoration: none; color: inherit;">
                                                                                                                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px; margin-bottom: 17px;">
                                                                                                                                        <h5 style="padding-left: 12px; font-weight: bold;" class="card-title">
                                                                                                                                            ${haber.title.replace("&apos;", "'")}
                                                                                                                                        </h5>
                                                                                                                                    </div>
                                                                                                                                </a>
                                                                                                                            </div>
                                                                                                                        `;
                                                            newsContainer.appendChild(div);
                                                        });

                                                        skip += take; // Skip değerini artır
                                                    })
                                                    .catch(error => {
                                                        console.error("Haberler yüklenirken hata oluştu:", error);
                                                    });
                                            }
                                        });

                                        observer.observe(loadMoreTrigger);
                                    });</script>
                            </div>

                            <div class="col-lg-4 col-md-4 order-1">

                                <div class="row">
                                  
                                        <h3 style="padding-top:5px;text-align:left;">Breaking News</h3>
                                  
                                <div class="col-lg-12 col-md-12 col-12 mb-12">
                                  
                                        @foreach (var sondakika in Model.sondakikahaberleri)
                                        {
                                            <div class="card">
                                                <div class="d-flex">
                                                    <div style="width:70%;">
                                                        <a href="@sondakika.Link" target="_blank" style="text-decoration: none; color: inherit;">
                                                            <div class="card-body">
                                                                <h5 class="card-title">@sondakika.Title</h5>
                                                                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;  font-weight: 500; font-size: 10px;">

                                                                    <span style="color:red;font-weight: bold;  padding-top: 10px;">
                                                                        @sondakika.Publisher
                                                                    </span>
                                                              

                                                                </div>
                                                            </div>
                                                        </a>
                                                    </div>
                                                    <div>
                                                        <a href="@sondakika.Link" target="_blank">
                                                            <img class="card-img card-img-right" src="@sondakika.ImageUrl" style="width: 140px; height: 100%; object-fit: cover;" alt="Son Dakika Haber Görseli">
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                            <br />}
                                   

                                </div>


                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- / Content -->
                <!-- Footer -->
                <!-- / Footer -->

                <div class="content-backdrop fade"></div>
            </div>
            <!-- Content wrapper -->
        </div>
            <!-- / Layout page -->
        </div>

        <!-- Overlay -->
        <div class="layout-overlay layout-menu-toggle"></div>
    </div>
    <!-- / Layout wrapper -->


    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->

    <script src="/assets/vendor/libs/jquery/jquery.js"></script>
    <script src="/assets/vendor/libs/popper/popper.js"></script>
    <script src="/assets/vendor/js/bootstrap.js"></script>
    <script src="/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="/assets/vendor/js/menu.js"></script>

    <!-- endbuild -->
    <!-- Vendors JS -->
    <script src="/assets/vendor/libs/apex-charts/apexcharts.js"></script>

    <!-- Main JS -->
    <script src="/assets/js/main.js"></script>

    <!-- Page JS -->
    <script src="/assets/js/dashboards-analytics.js"></script>

    <!-- Place this tag before closing body tag for github widget button. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
</body>

